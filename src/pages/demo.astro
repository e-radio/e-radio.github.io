---
import Layout from '../layouts/Layout.astro';
import SEO from '../components/SEO.astro';
import { slugify } from "../lib/slug";
import { Image } from "astro:assets";

const title = "Demo ‚Äì E-Radio Greece";
const description = "Explore a demo page showcasing station listings, badges, and layout styles for E-Radio Greece, including sample cards, icons, and interactions used across the site.";
const canonical = "https://e-radio.github.io/demo/";
const demoIcon = "/radddio-app-icon.png";
const radddioURL = "https://apple.co/4lNPQAH";
const radddioBadgeUrl = "/radddio-badge.svg";
const demoStations = [
  {
    name: "Aegean Chill",
    state: "Cyclades",
    votes: 1245,
    bitrate: 128,
    genres: ["Chillout", "Lounge", "Ambient"],
  },
  {
    name: "Athens Rock FM",
    state: "Attica",
    votes: 987,
    bitrate: 192,
    genres: ["Rock", "Alternative"],
  },
  {
    name: "Thessaloniki Beats",
    state: "Central Macedonia",
    votes: 562,
    bitrate: 256,
    genres: ["Electronic", "Dance"],
  },
];

const metadataStations = [
  {
    name: "Dice Radio",
    slug: "dice-radio",
    platform: "Radio.co",
    streamUrl: "https://s2.radio.co/s4648f1c61/listen",
    nowPlayingEndpoint: "https://public.radio.co/station/s4648f1c61/nowplaying",
  },
  {
    name: "Kyklos",
    slug: "kyklos",
    platform: "AzuraCast",
    streamUrl: "https://azuracast.streams.ovh/radio/8120/radio.mp3",
    nowPlayingEndpoint: "https://azuracast.streams.ovh/api/nowplaying/radiokyklos",
  },
  {
    name: "Kaseta Radio",
    slug: "kaseta-radio",
    platform: "AzuraCast",
    streamUrl: "https://azuracast.streams.gr/listen/kasetaradio/radio.mp3",
    nowPlayingEndpoint: "https://azuracast.streams.gr/api/nowplaying/kasetaradio",
  },
];
---

<Layout title={title} description={description}>
  <SEO 
    slot="seo"
    title={title}
    description={description}
    canonical={canonical}
    ogTitle={title}
    ogDescription={description}
    ogImage="/e-radio-og-image.png"
  />

  <section class="mb-5">
    <h1 class="display-5 fw-bold mb-3">Design Demo</h1>
    <p class="lead text-muted mb-0">
      Use this page to validate typography, spacing, and badge styles without touching production data.
      The components below reuse the same CSS classes as the live station listings.
    </p>
  </section>

  <section class="mb-5">
    <h2 class="fs-4 fw-semibold mb-3">Station Card Preview</h2>
    <div class="station-list border border-light-subtle rounded-3 overflow-hidden">
      {demoStations.map((station, index) => (
        <div class={`station-item position-relative ${index !== demoStations.length - 1 ? 'border-bottom border-light-subtle' : ''}`} itemscope itemtype="https://schema.org/RadioStation">
          <div class="station-item-body p-3">
            <div class="row align-items-center g-3">
              <div class="col-auto">
                <Image src={demoIcon} alt="Demo station icon" class="rounded station-logo" width={60} height={60} itemprop="image" />
              </div>

              <div class="col flex-grow-1">
                <h3 class="mb-1 fs-6 fw-bold text-dark" itemprop="name">{station.name}</h3>
                <p class="small text-muted mb-0">
                  üìç {station.state}
                </p>
                <div class="d-flex gap-2 flex-wrap align-items-center mt-2">
                  <span class="badge d-inline-flex align-items-center p-1 pe-2 text-info-emphasis bg-info-subtle border border-info-subtle">
                    <i class="bi bi-stars px-1" aria-hidden="true"></i>
                    Votes
                    <span class="vr mx-2"></span>
                    {station.votes.toLocaleString()}
                  </span>
                  <span class="badge d-inline-flex align-items-center p-1 pe-2 text-success-emphasis bg-success-subtle border border-success-subtle">
                    <i class="bi bi-soundwave px-1" aria-hidden="true"></i>
                    Bitrate
                    <span class="vr mx-2"></span>
                    {station.bitrate} kbps
                  </span>
                  {station.genres.map((genre) => (
                    <a
                      href={`/genres/${slugify(genre)}/`}
                      class="badge bg-secondary-subtle text-secondary-emphasis rounded-pill text-decoration-none genre-badge-link"
                    >
                      {genre}
                    </a>
                  ))}
                </div>
              </div>

              <div class="col-auto text-end d-none d-md-block">
                <a href={radddioURL} class="text-decoration-none radddio-badge" aria-label={`Listen to ${station.name} on Radddio App`} role="link" target="_blank" rel="nofollow noopener">
                  <Image src={radddioBadgeUrl} alt="Radddio App Badge" width={144} height={47} />
                </a>
              </div>
            </div>
          </div>
        </div>
      ))}
    </div>
  </section>

  <section class="mb-5">
    <h2 class="fs-4 fw-semibold mb-3">Badge Palette</h2>
    <div class="d-flex flex-wrap gap-2">
      <span class="badge d-inline-flex align-items-center p-1 pe-2 text-info-emphasis bg-info-subtle border border-info-subtle">
        <i class="bi bi-stars px-1" aria-hidden="true"></i>
        Votes
        <span class="vr mx-2"></span>
        9,999
      </span>
      <span class="badge d-inline-flex align-items-center p-1 pe-2 text-success-emphasis bg-success-subtle border border-success-subtle">
        <i class="bi bi-soundwave px-1" aria-hidden="true"></i>
        Bitrate
        <span class="vr mx-2"></span>
        320 kbps
      </span>
      <a href={`/genres/${slugify("Jazz")}/`} class="badge bg-secondary-subtle text-secondary-emphasis rounded-pill text-decoration-none genre-badge-link">Jazz</a>
      <a href={`/genres/${slugify("Talk")}/`} class="badge bg-secondary-subtle text-secondary-emphasis rounded-pill text-decoration-none genre-badge-link">Talk</a>
    </div>
  </section>

  <section class="mb-5">
    <h2 class="fs-4 fw-semibold mb-3">Now Playing API Experiments</h2>
    <p class="text-muted mb-4">
      Many stations use platforms like Radio.co or AzuraCast that expose simple JSON endpoints. The recipe is straightforward:
      <span class="d-block mt-2">‚Ä¢ fetch the <span class="fw-semibold">nowPlayingUrl</span> every 10‚Äì20 seconds</span>
      <span class="d-block">‚Ä¢ update the UI with the returned artist and title</span>
    </p>
    <div class="row g-4">
      {metadataStations.map((station, index) => (
        <div class="col-12 col-lg-4">
          <div class="card h-100 border border-light-subtle" data-nowplaying-endpoint={station.nowPlayingEndpoint} data-refresh-ms="15000">
            <div class="card-body d-flex flex-column">
              <div class="mb-3">
                <h3 class="h6 fw-semibold mb-1">{station.name}</h3>
                <p class="text-muted small mb-0">Platform: {station.platform}</p>
              </div>
              <dl class="small text-muted mb-3">
                <dt class="fw-semibold">Stream URL</dt>
                <dd class="mb-2"><code>{station.streamUrl}</code></dd>
                <dt class="fw-semibold">Now Playing endpoint</dt>
                <dd class="mb-0"><code>{station.nowPlayingEndpoint}</code></dd>
              </dl>
              <div class="bg-light-subtle border border-light-subtle rounded p-2 mt-auto">
                <p class="small text-muted mb-1">Latest response:</p>
                <pre class="bg-white rounded p-2 small mb-0 overflow-auto" style="max-height: 180px;" id={`nowplaying-${index}`}>Waiting‚Ä¶</pre>
              </div>
            </div>
          </div>
        </div>
      ))}
    </div>
    <p class="small text-muted mt-3 mb-0">CORS policies come from the station. If you see errors, the endpoint may block browser access and will need a proxy.</p>
  </section>

  <section>
    <h2 class="fs-4 fw-semibold mb-3">Implementation Notes</h2>
    <ul class="list-unstyled text-muted mb-0">
      <li class="mb-2">‚úîÔ∏è Reuses <code>.station-list</code>, <code>.station-item</code>, and badge utilities from global.css.</li>
      <li class="mb-2">‚úîÔ∏è Icons sourced from Bootstrap Icons CDN already included in the base layout.</li>
      <li class="mb-2">‚úîÔ∏è No scripts or extra styles required‚Äîsafe to remove when no longer needed.</li>
    </ul>
  </section>
  <script type="module">
    const cards = document.querySelectorAll('[data-nowplaying-endpoint]');

    const fetchNowPlaying = async (card, output) => {
      const endpoint = card.getAttribute('data-nowplaying-endpoint');
      if (!endpoint) return;
      try {
        const response = await fetch(endpoint, { cache: 'no-store' });
        if (!response.ok) throw new Error(`${response.status} ${response.statusText}`);
        const data = await response.json();
        output.textContent = JSON.stringify(data, null, 2);
      } catch (error) {
        output.textContent = `Error: ${error.message}`;
      }
    };

    cards.forEach((card, index) => {
      const output = card.querySelector(`#nowplaying-${index}`);
      if (!output) return;
      const refreshMs = Number(card.getAttribute('data-refresh-ms') || 15000);
      fetchNowPlaying(card, output);
      setInterval(() => fetchNowPlaying(card, output), refreshMs);
    });
  </script>
  </Layout>